# 表单插件

## 插件级别
- 页面级别
- 站点级别
- 插件级别 (√)
- 产品级别

## 插件级别的考虑
### 自定义属性的约定
1. 可以通过插件，配置错误的类名， 如果没有配置， 使用默认类名： `field-error`
    - 约定： 错误类目，应该加到表单域的容器中
2. 【必填】约定： 表单域的容器指一个具有自定义属性 `data-field-container` 的元素,该属性的值必须等于表单字段名。
3. 【必填】约定： 要验证的表单域(字段)应该具有自定义属性 `data-field`，该属性没有值
4. 约定： 要验证的属性使用自定义属性 `data-field-prop` 指定，如果没有指定，默认 value 值。
5. 约定： 要监听的事件使用自定义属性 `data-field-listener` 指定要监听的时间，如果没有指定，使用默认值 change 事件
6. 约定： 事件是要触发哪些表单域的相关验证，比如 密码、确认密码 关联，默认情况先只处理自身的验证，可以通过 `data-field-trigger` 设置要验证的其他表单域，多个名称之间使用英文逗号分隔，中间不能有空格。
7. 约定： 通过自定义属性 `data-field-error` 表示错误消息的元素，如果不写，则寻找类样式 error,

### 构造函数的参数
1. 表单的 DOM 对象(特别注意：一个表单 DOM 对象不一定是 form 元素)
2. 错误的类名， 默认为 field-error
3. 所有表单域的验证规则，称之为表单规则

### 表单规则
1. 表单规则是一个对象
2. 对象中的每一个属性名对应表单的字段名

```js
var formRule = {
  loginId: 规则,
  pwd: 规则,
  pwdAgain: 规则
}
```
3. 属性值表示规则数组，该插件验证时，会根据数组中提供的规则顺序进行验证， 所有验证都是 **同步** 的；并且一个验证失败，不会进行后续规则的验证。
```js
var formRule = {
  loginId: [],
  pwd: [],
  pwdAgain: []
}
```
4. 每一个具体规则，是一个对象,
```js
var formRule = {
  loginId: [
    {},{},...
  ],
  pwd: [],
  pwdAgain: []
}
```
该对象中包含两个属性，rule 属性表示具体规则，第二个属性 msg 表示错误消息。
```js
var formRule = {
  loginId: [
    {
      rule: 具体规则,
      msg: 错误消息
    },
    {
      rule: "required",
      msg: "请填写账号"
    }
  ],
  ...
}
```
5. - rule 属性，预设值
      - required：表示必填
      - mail：邮箱
      - number：数字
      - 考虑到将来插件升级后，会有更多预设值

   - rule 属性，正则表达式
    ```js
      {
        rule: /^.{6,12}$/,
        msg: "账号必须是6-12位字符"
      }
    ```
   - rule 属性，是个函数--验证函数
      - 参数一 value: 表单当前表单域的值
      - 参数二 formData: 整个表单数据
      - 如果验证通过，返回 true，否则返回错误消息
      - 使用验证函数后， msg 属性无效
   ```js
    {
      rule: function(value, formData) {
        if(vale === formData.pwd) {
          return true
        } else {
          return 'xxxxx'
        }
      }
    }
   ```

### 通过构造函数创建的对象
1. 自动的，会根据相应的配置，对表单进行自动验证
2. 提供 validate 方法，并且返回验证结果
    - 无参： 验证整个表单
    - 有参： 验证指定的表单域
3. 提供 getFormData 方法，该方法返回整个表单对象